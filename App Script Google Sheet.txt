function doGet(e) {
  Logger.log(JSON.stringify(e));
  var result = 'Ok';

  if (e.parameter == 'undefined') {
    result = 'No Parameters';
  } else {
    var sheet_id = '1Alyy7n-RNf7emKxl0KxL4ZnAqZUq9l3cOS2OymUSfjE'; // Spreadsheet ID
    var sheet = SpreadsheetApp.openById(sheet_id).getActiveSheet();
    var newRow = sheet.getLastRow() + 1;
    var rowData = [];
    var Curr_Date = new Date();
    rowData[0] = Curr_Date; // Date in column A
    var Curr_Time = Utilities.formatDate(Curr_Date, "Asia/Bangkok",'HH:mm:ss');
    rowData[1] = Curr_Time; // Time in column B

    for (var param in e.parameter) {
      Logger.log('In for loop, param=' + param);
      var value = stripQuotes(e.parameter[param]);
      Logger.log(param + ':' + e.parameter[param]);
      
      switch (param) {
        case 'id':
          rowData[2] = value;
          result = 'OK';
          break;
        default:
          result = "unsupported parameter";
      }
    }

    Logger.log(JSON.stringify(rowData));
    var newRange = sheet.getRange(newRow, 1, 1, rowData.length);
    newRange.setValues([rowData]);
  }

  return ContentService.createTextOutput(result);
}

function stripQuotes(value) {
  return value.replace(/^["']|['"]$/g, "");
}

function sendToLineNotify() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName("B");
  const token = sheet.getRange(2, 3).getValue();
  const content = sheet.getRange(3, 3).getValue();
  const content2 = sheet.getRange(4, 3).getValue();
  const content3 = sheet.getRange(5, 3).getValue();

  if (!content || !token) {
    Logger.log("Access Token ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤");
    return;
  }

  const message = "\n" + "‡πÉ‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà : " + content2 + "\n" + content + "\n" + "‡∏•‡∏¥‡πâ‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î :" + content3 + "\n" + "Thank you very much for usingüôè"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ + ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

  const options = {
    "method": "post",
    "payload": {
      "message": message
    },
    "headers": {
      "Authorization": "Bearer " + token,
    },
  };

  const response = UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);

  if (response.getResponseCode() === 200) {
    Logger.log("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE Notify ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
  } else {
    Logger.log("‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE Notify");
  }
}

function exportToPDFAndSendToSheets() {
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  var sourceSheet = spreadsheet.getSheetByName('A');
  var targetSheet2 = spreadsheet.getSheetByName('B');

  var blob = spreadsheet.getBlob();

  var pdfFile = DriveApp.createFile(blob).setName('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ.pdf');
  var pdfUrl = pdfFile.getUrl();

  pdfFile.setTrashed(true);

  targetSheet2.getRange(10, 3).setValue(pdfUrl);
}

function deleteData() {
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = spreadsheet.getSheetByName('A'); // ‡πÅ‡∏ó‡∏ô '‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  var lastRow = sheet.getLastRow();

  // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A, B, ‡πÅ‡∏•‡∏∞ C ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  sheet.getRange('A2:C' + lastRow).clearContent();
}

function changeBackgroundColor() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var range = sheet.getDataRange();
  var values = range.getValues();

  for (var i = 0; i < values.length; i++) {
    var cellValue = values[i][0]; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A
    var cellColor = ''; // ‡∏™‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á

    if (cellValue instanceof Date) {
      var dayOfWeek = cellValue.getDay();
      
      switch (dayOfWeek) {
        case 0: // ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
          cellColor = '#FADCDC'; // ‡∏™‡∏µ Cosmos
          break;
        case 1: // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå
          cellColor = '#FDFFE4'; // ‡∏™‡∏µ China Ivory
          break;
        case 2: // ‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£
          cellColor = '#F8D5F8'; // ‡∏™‡∏µ Pink Lace
          break;
        case 3: // ‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò
          cellColor = '#D0F4DE'; // ‡∏™‡∏µ Granny Apple
          break;
        case 4: // ‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ
          cellColor = '#FFE2D1'; // ‡∏™‡∏µ Watusi
          break;
        case 5: // ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå
          cellColor = '#E5F9FE'; // ‡∏™‡∏µ Oyster Bay
          break;
        case 6: // ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå
          cellColor = '#D4D2F2'; // ‡∏™‡∏µ Moon Laker
          break;
      }
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡∏ñ‡∏∂‡∏á F
    for (var col = 0; col < 6; col++) {
      range.getCell(i + 1, col + 1).setBackground(cellColor); // i+1 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÅ‡∏ñ‡∏ß, col+1 ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    }
  }
}

function onEdit(e) {
  var sheet = e.source.getActiveSheet();
  var range = e.range;
  var column = range.getColumn();
  var row = range.getRow();

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡∏ñ‡∏∂‡∏á F
  if (column >= 1 && column <= 6) {
    var cellValue = sheet.getRange(row, 1).getValue();
    var cellColor = '';

    if (cellValue instanceof Date) {
      var dayOfWeek = cellValue.getDay();

      switch (dayOfWeek) {
        case 0: // ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
          cellColor = '#FADCDC'; // ‡∏™‡∏µ Cosmos
          break;
        case 1: // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå
          cellColor = '#FDFFE4'; // ‡∏™‡∏µ China Ivory
          break;
        case 2: // ‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£
          cellColor = '#F8D5F8'; // ‡∏™‡∏µ Pink Lace
          break;
        case 3: // ‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò
          cellColor = '#D0F4DE'; // ‡∏™‡∏µ Granny Apple
          break;
        case 4: // ‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ
          cellColor = '#FFE2D1'; // ‡∏™‡∏µ Watusi
          break;
        case 5: // ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå
          cellColor = '#E5F9FE'; // ‡∏™‡∏µ Oyster Bay
          break;
        case 6: // ‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå
          cellColor = '#D4D2F2'; // ‡∏™‡∏µ Moon Laker
          break;
      }
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡πå A ‡∏ñ‡∏∂‡∏á F
    for (var col = 1; col <= 6; col++) {
      sheet.getRange(row, col).setBackground(cellColor);
    }
  }
}
